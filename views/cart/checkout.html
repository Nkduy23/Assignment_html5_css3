<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thanh toán</title>
    <link rel="stylesheet" href="../../assets/css/main.css" />
    <link rel="stylesheet" href="../../assets/css/checkout.css" />
  </head>
  <body>
    <div id="header-placeholder"></div>

    <div class="checkout-container">
      <h2>Thông tin thanh toán</h2>

      <div class="checkout-layout">
        <!-- Bảng đơn hàng -->
        <div class="order-summary">
          <h3>Đơn hàng của bạn</h3>
          <table>
            <thead>
              <tr>
                <th>Sản phẩm</th>
                <th>Số lượng</th>
                <th>Giá</th>
                <th>Tổng</th>
              </tr>
            </thead>
            <tbody id="order-summary">
              <!-- Dữ liệu sản phẩm -->
            </tbody>
          </table>
          <h3>Tổng cộng: <span id="checkout-total">0</span> đ</h3>
        </div>

        <!-- Form thông tin khách hàng -->
        <div class="customer-info">
          <h3>Thông tin khách hàng</h3>
          <form id="checkout-form">
            <label for="fullname">Họ và tên:</label>
            <input type="text" id="fullname" required />

            <label for="phone">Số điện thoại:</label>
            <input type="tel" id="phone" required />

            <label for="address">Địa chỉ giao hàng:</label>
            <input type="text" id="address" required />

            <label for="email">Email:</label>
            <input type="email" id="email" />

            <label for="payment-method">Phương thức thanh toán:</label>
            <select id="payment-method" required>
              <option value="cod">Thanh toán khi nhận hàng (COD)</option>
              <option value="bank">Chuyển khoản ngân hàng</option>
              <option value="momo">Ví MoMo</option>
            </select>

            <button type="submit" id="confirm-payment">Xác nhận thanh toán</button>
          </form>
        </div>
      </div>
    </div>

    <div id="footer-placeholder"></div>
    <script src="../../assets/js/product-detail-main.js" type="module"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const orderSummary = document.getElementById("order-summary");
        const checkoutTotal = document.getElementById("checkout-total");
        const checkoutForm = document.getElementById("checkout-form");

        let cartItems = JSON.parse(localStorage.getItem("checkoutCart")) || [];

        if (cartItems.length === 0) {
          orderSummary.innerHTML = "<tr><td colspan='4'>Không có sản phẩm nào trong đơn hàng.</td></tr>";
          return;
        }

        let total = 0;
        cartItems.forEach((item) => {
          const itemTotal = parseFloat(item.price.replace(/[^0-9]/g, "")) * item.quantity;
          total += itemTotal;

          const row = document.createElement("tr");
          row.innerHTML = `
      <td>${item.name}</td>
      <td>${item.quantity}</td>
      <td>${item.price} đ</td>
      <td>${itemTotal.toLocaleString()} đ</td>
    `;
          orderSummary.appendChild(row);
        });

        checkoutTotal.textContent = total.toLocaleString();

        // Xử lý thanh toán khi submit form
        checkoutForm.addEventListener("submit", function (event) {
          event.preventDefault();

          const fullname = document.getElementById("fullname").value.trim();
          const phone = document.getElementById("phone").value.trim();
          const address = document.getElementById("address").value.trim();
          const email = document.getElementById("email").value.trim();
          const paymentMethod = document.getElementById("payment-method").value;

          if (!fullname || !phone || !address || !paymentMethod) {
            alert("Vui lòng điền đầy đủ thông tin.");
            return;
          }

          const orderData = {
            fullname,
            phone,
            address,
            email,
            paymentMethod,
            items: cartItems,
            totalPrice: total,
          };

          console.log("Dữ liệu đơn hàng:", orderData);

          // Xóa giỏ hàng sau khi đặt hàng
          localStorage.removeItem("checkoutCart");
          localStorage.removeItem("cart");

          alert("Thanh toán thành công!");

          // Chuyển hướng về trang chủ
          window.location.href = "../../index.html";
        });
      });
    </script>
  </body>
</html>
